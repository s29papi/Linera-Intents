# CLI Guide: How Variables Are Generated + How to Create/Approve/Buy/Sell

This guide is derived from `scripts/cli.sh`. It has two parts:
1) how shared variables are generated, and
2) how to create a token, approve, buy, and sell.

## 1) How Variables and Shared Variables Are Generated

There are four sources for variables used by the CLI.

### Source A — Static values already inside `scripts/cli.sh`
These values exist because they are written directly in the file. They only change if you edit the file.

Examples in this repo:
- CHAIN_ID
- OWNER
- OWNER_USER2
- TOKEN_NAME, TOKEN_SYMBOL, TOKEN_DECIMALS, TOKEN_INITIAL_SUPPLY
- GraphQL base URL (`http://127.0.0.1:8080`)

### Source B — Module IDs (from publishing WASM)
These are created when you publish the contract/service WASM files.

Command that generates them:
```
./scripts/cli.sh publish
```

Where you put them:
- FUNGIBLE_MODULE_ID
- TOKEN_FACTORY_MODULE_ID
- FAUCET_MODULE_ID
- MATCHING_ENGINE_MODULE_ID

### Source C — App IDs (from create-application)
These are created when you instantiate applications from module IDs.

Commands that generate them:
```
./scripts/cli.sh apps
./scripts/cli.sh wlin
```

Where you put them:
- TOKEN_FACTORY_APP_ID
- MATCHING_ENGINE_APP_ID
- FAUCET_APP_ID
- WLIN_APP_ID

### Source D — Token App ID (from token factory)
This is created when you look up the app ID for a specific token symbol.

Command that generates it:
```
TOKEN_SYMBOL=TST7 ./scripts/cli.sh token-app-id
```

Where you put it:
- TST_APP_ID

### Source E — Signatures (from signing helper)
Signatures are generated by the signing program. They must match the payload you are going to submit.

Command that generates them:
```
cargo run --manifest-path scripts/sign_create_token/Cargo.toml
```

Where you put them:
- CREATE_TOKEN_SIG
- WLIN_APPROVE_SIG
- TST_APPROVE_SIG
- BUY_SIG
- SELL_SIG
(and *_USER2 variants if user2 is used)

## 2) Guide: Create Token → Approve → Buy → Sell

### Step 0 — Start the GraphQL Service
The service must be running before any GraphQL calls.

Command:
```
./scripts/cli.sh service
```

### Step 1 — Create Token

Notes:
- TOKEN_SYMBOL is modifiable. Example shown here uses TOKEN_SYMBOL=TST7.
- Each token symbol must be unique; you cannot create two tokens with the same symbol.

Creates the token and initializes its pool in the matching engine.

Command:
```
TOKEN_SYMBOL=TST7 ./scripts/cli.sh create-token
```

Inputs used:
- OWNER
- TOKEN_NAME
- TOKEN_SYMBOL
- TOKEN_DECIMALS
- TOKEN_INITIAL_SUPPLY
- CREATE_TOKEN_SIG
- TOKEN_FACTORY_APP_ID

### Step 2 — Mint wLin
Gives the owner wLin so they can buy the token.

Command:
```
./scripts/cli.sh mint
```

Inputs used:
- OWNER
- FAUCET_APP_ID

### Step 3 — Approve wLin + Token
Allows the matching engine to transfer wLin and the token during trades.

Command:
```
./scripts/cli.sh approve
```

Inputs used:
- OWNER
- WLIN_APP_ID
- TST_APP_ID
- MATCHING_ENGINE_APP_ID
- WLIN_APPROVE_SIG
- TST_APPROVE_SIG

### Step 4 — Buy
Buys the token with wLin.

Command:
```
TOKEN_SYMBOL=TST7 ./scripts/cli.sh buy
```

Inputs used:
- OWNER
- TOKEN_SYMBOL
- MATCHING_ENGINE_APP_ID
- BUY_SIG

Defaults used by the CLI:
- amount = 10
- minOut = 1

### Step 5 — Sell
Sells the token back into the pool.

Command:
```
TOKEN_SYMBOL=TST7 ./scripts/cli.sh sell
```

Inputs used:
- OWNER
- TOKEN_SYMBOL
- MATCHING_ENGINE_APP_ID
- SELL_SIG

Defaults used by the CLI:
- amount = 10
- minOut = 1
